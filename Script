-- Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local InsertService = game:GetService("InsertService")
local TweenService = game:GetService("TweenService")
local MarketplaceService = game:GetService("MarketplaceService")
local player = Players.LocalPlayer

-- Shared settings for saving position
if not shared.CashewSettings then shared.CashewSettings = {} end

-- UI Setup
local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
gui.Name = "CashewGUI"
gui.ResetOnSpawn = false

-- Blur Setup
local blur = Instance.new("BlurEffect", workspace)
blur.Size = 0
blur.Enabled = false

-- Icon Button
local iconBtn = Instance.new("ImageButton", gui)
iconBtn.Size = UDim2.new(0, 50,0,50)
iconBtn.Position = UDim2.new(0,10,0,10)
iconBtn.Image = "rbxassetid://<YOUR_ICON_ASSET_ID>"
Instance.new("UICorner", iconBtn)
Instance.new("UIStroke", iconBtn).Thickness = 2

-- Main Window
local main = Instance.new("Frame", gui)
main.Size = UDim2.new(0,400,0,500)
main.Position = shared.CashewSettings.LastPos or UDim2.new(0.5,-200,0.5,-250)
main.BackgroundColor3 = Color3.fromRGB(30,30,30)
Instance.new("UICorner", main)
local stroke = Instance.new("UIStroke", main)
stroke.Color = Color3.new(0.2,0.2,0.2); stroke.Thickness = 2

-- Save pos on drag end
main.Active = true
main.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		main.Draggable = true
	end
end)
main.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		main.Draggable = false
		shared.CashewSettings.LastPos = main.Position
	end
end)

-- Blur effect toggle
local function setBlur(on)
	TweenService:Create(blur, TweenInfo.new(0.5), {Size = on and 24 or 0}):Play()
	blur.Enabled = on
end

-- Icon Toggle
local guiVisible = false
iconBtn.MouseButton1Click:Connect(function()
	guiVisible = not guiVisible
	main.Visible = guiVisible
	setBlur(guiVisible)
	UserInputService.MouseBehavior = guiVisible and Enum.MouseBehavior.Default or Enum.MouseBehavior.LockCenter
end)

-- Auto open on join
main.Visible = true; guiVisible = true; setBlur(true)

-- Title bar
local titleBar = Instance.new("Frame", main)
titleBar.Size = UDim2.new(1,0,0,30)
titleBar.BackgroundColor3 = Color3.fromRGB(20,20,20)
titleBar.Position = UDim2.new(0,0,0,0)
Instance.new("UICorner", titleBar)

local title = Instance.new("TextLabel", titleBar)
title.Size = UDim2.new(1,0,1,0)
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBold
title.Text = "Cashew's GUI • " .. pcall(function() return MarketplaceService:GetProductInfo(game.PlaceId).Name end) and tostring(game.PlaceId)
title.TextColor3 = Color3.new(1,1,1)

-- Tabs setup
local tabs = {"Main","Player","Tools","Troll"}
local buttons, panels = {}, {}

local function createTabBtn(name,index)
	local btn = Instance.new("TextButton",main)
	btn.Size = UDim2.new(0,100,0,40)
	btn.Position = UDim2.new(0,0,0,30+(index-1)*42)
	btn.Text = name
	btn.Font = Enum.Font.GothamBold; btn.TextColor3 = Color3.new(1,1,1)
	btn.BackgroundColor3 = Color3.fromRGB(40,40,40)
	Instance.new("UICorner",btn)
	local panel = Instance.new("Frame",main)
	panel.BackgroundTransparency = 1
	panel.Position = UDim2.new(0,100,0,30)
	panel.Size = UDim2.new(1,-100,1,-30)
	panel.Visible = index == 1
	buttons[name]=btn; panels[name]=panel
	btn.MouseButton1Click:Connect(function()
		for _,p in pairs(panels) do p.Visible=false end
		panel.Visible = true
	end)
	return panel
end

local mainPanel = createTabBtn("Main",1)
local playerPanel = createTabBtn("Player",2)
local toolsPanel = createTabBtn("Tools",3)
local trollPanel = createTabBtn("Troll",4)

-- Player tab UI
local function addToggle(panel, posY, text, onChange)
	local on = false
	local btn = Instance.new("TextButton",panel)
	btn.Position=UDim2.new(0,10,0,posY)
	btn.Size=UDim2.new(0,200,0,30)
	btn.Text = "❌ "..text
	btn.Font=Enum.Font.Gotham; btn.TextColor3=Color3.new(1,1,1)
	btn.BackgroundColor3 = Color3.fromRGB(50,50,50)
	Instance.new("UICorner",btn)
	btn.MouseButton1Click:Connect(function()
		on = not on
		btn.Text = (on and "✅ " or "❌ ") .. text
		onChange(on)
	end)
	return btn
end

local function addSlider(panel, y, text, min,max,default,callback)
	local label=Instance.new("TextLabel",panel)
	label.Position=UDim2.new(0,10,0,y)
	label.Size=UDim2.new(0,200,0,20)
	label.Text = text..": "..default
	label.Font=Enum.Font.Gotham; label.TextColor3=Color3.new(1,1,1)
	label.BackgroundTransparency=1
	local slider = Instance.new("Frame",panel)
	slider.Position=UDim2.new(0,220,0,y)
	slider.Size=UDim2.new(0,150,0,10)
	slider.BackgroundColor3=Color3.fromRGB(80,80,80)
	Instance.new("UICorner",slider)
	local knob = Instance.new("Frame",slider)
	knob.Size=UDim2.new((default-min)/(max-min),0,1,0)
	knob.BackgroundColor3=Color3.fromRGB(0,170,255)
	Instance.new("UICorner",knob)
	knob.Active=true; knob.Selectable=true
	local dragging=false
	local function update(x)
		local pct=math.clamp((x-slider.AbsolutePosition.X)/slider.AbsoluteSize.X,0,1)
		knob.Size=UDim2.new(pct,0,1,0)
		knob.Position=UDim2.new(pct,0,0,0)
		local value=math.floor(min+(max-min)*pct)
		label.Text = text..": "..value
		callback(value)
	end
	knob.InputBegan:Connect(function(i)
		if i.UserInputType==Enum.UserInputType.MouseButton1 or i.UserInputType==Enum.UserInputType.Touch then dragging=true end
	end)
	UserInputService.InputEnded:Connect(function(i) if dragging then dragging=false end end)
	UserInputService.InputChanged:Connect(function(i)
		if dragging then update(i.Position.X) end
	end)
end

-- Speed and Jump sliders
addSlider(playerPanel,10,"WalkSpeed",16,200,16,function(v)
	local hum = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
	if hum then hum.WalkSpeed=v end
end)
addSlider(playerPanel,60,"JumpPower",50,300,50,function(v)
	local hum = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
	if hum then hum.JumpPower=v end
end)

-- Toggle features
addToggle(playerPanel, 110, "Infinite Jump", function(on)
	_G.InfJump = on
end)

UserInputService.JumpRequest:Connect(function()
	if _G.InfJump and player.Character then
		player.Character:FindFirstChildOfClass("Humanoid"):ChangeState("Jumping")
	end
end)

addToggle(playerPanel, 150, "Invisibility", function(on)
	for _,part in ipairs(player.Character and player.Character:GetDescendants() or {}) do
		if part:IsA("BasePart") or part:IsA("Decal") then
			part.Transparency = on and 1 or 0
		end
	end
end)

-- Fly toggle (simple float)
local flying = false
local flySpeed = 50
addToggle(playerPanel, 190, "Fly", function(on)
	flying = on
	if on then
		local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
		if hrp then
			hrp.Anchored = true
			coroutine.wrap(function()
				while flying and hrp do
					local cam = workspace.CurrentCamera
					hrp.CFrame = hrp.CFrame:Lerp(cam.CFrame, flySpeed/1000)
					wait()
				end
				if hrp then hrp.Anchored = false end
			end)()
		end
	end
end)

-- Tools Tab
local toolsID = Instance.new("TextBox",toolsPanel)
toolsID.Position=UDim2.new(0,10,0,10); toolsID.Size=UDim2.new(0,150,0,25)
toolsID.PlaceholderText="Tool ID"
toolsID.BackgroundColor3 = Color3.fromRGB(255,255,255)
toolsID.TextColor3 = Color3.new(0,0,0)

local spawnBtn = Instance.new("TextButton",toolsPanel)
spawnBtn.Position=UDim2.new(0,170,0,10); spawnBtn.Size=UDim2.new(0,100,0,25)
spawnBtn.Text="Spawn Tool"; spawnBtn.BackgroundColor3=Color3.fromRGB(80,80,80)
spawnBtn.TextColor3=Color3.new(1,1,1)
Instance.new("UICorner",spawnBtn)
spawnBtn.MouseButton1Click:Connect(function()
	local id=tonumber(toolsID.Text)
	if id then
		local ok,model=pcall(function() return InsertService:LoadAsset(id) end)
		if ok and model then
			local function findTool(o)
				if o:IsA("Tool") then return o end
				for _,c in ipairs(o:GetChildren()) do
					local t=findTool(c); if t then return t end
				end
			end
			local tool=findTool(model)
			if tool then tool.Parent = player.Backpack end
			model:Destroy()
		end
	end
end)

-- Troll Tab
local jerkBtn = Instance.new("TextButton",t trollPanel)
jerkBtn.Position=UDim2.new(0,10,0,10); jerkBtn.Size=UDim2.new(0,180,0,35)
jerkBtn.Text="⚡ Jerk"; jerkBtn.BackgroundColor3=Color3.fromRGB(60,60,60); jerkBtn.TextColor3=Color3.new(1,1,1)
Instance.new("UICorner", jerkBtn)

local function runFromURL(url)
	local s,r=pcall(function() return game:HttpGet(url) end)
	if s then loadstring(r)() else warn("Error loading troll script:",r) end
end

jerkBtn.MouseButton1Click:Connect(function()
	local hum = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
	if hum.RigType == Enum.HumanoidRigType.R6 then
		runFromURL("https://pastefy.app/wa3v2Vgm/raw")
	else
		runFromURL("https://pastefy.app/YZoglOyJ/raw")
	end
end)
